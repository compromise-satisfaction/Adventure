/**
 * enchant.js v0.5.2 (MOD by katwat)
 *
 * Copyright (c) Ubiquitous Entertainment Inc.
 * Dual licensed under the MIT or GPL Version 3 licenses
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
"function"!==typeof Object.defineProperty&&(Object.defineProperty=function(a,b,c){"value"in c&&(a[b]=c.value);"get"in c&&a.__defineGetter__(b,c.get);"set"in c&&a.__defineSetter__(b,c.set);return a});"function"!==typeof Object.defineProperties&&(Object.defineProperties=function(a,b){for(var c in b)b.hasOwnProperty(c)&&Object.defineProperty(a,c,b[c]);return a});
"function"!==typeof Object.create&&(Object.create=function(a,b){function c(){}c.prototype=a;var d=new c;null!=b&&Object.defineProperties(d,b);return d});"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf=function(a){return a.__proto__});
"function"!==typeof Function.prototype.bind&&(Function.prototype.bind=function(a){var b=this,c=Array.prototype.slice.call(arguments,1),d=function(){},e=function(){var e=c.concat(Array.prototype.slice.call(arguments));return b.apply(this instanceof d?this:a||window,e)};d.prototype=b.prototype;e.prototype=new d;return e});
window.now=function(){return window.performance&&window.performance.now?function(){return window.performance.now()}:window.performance&&window.performance.webkitNow?function(){return window.performance.webkitNow()}:Date.now}();
window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(){var a=window.now(),b=1E3/60;return function(c){return setTimeout(function(){a=window.now();c(a)},Math.max(0,a+b-window.now()))}}();
var enchant=function(a){null!=a&&(a instanceof Array||(a=Array.prototype.slice.call(arguments)),a=a.filter(function(a){return""+a}));(function c(d,e){var f=[],g,h;for(h in d)d.hasOwnProperty(h)&&("function"===typeof d[h]?window[h]=d[h]:"object"===typeof d[h]&&Object.getPrototypeOf(d[h])===Object.prototype&&(null==a?f.push(h):(g=a.indexOf(e+h),-1!==g&&(f.push(h),a.splice(g,1)))));g=0;for(h=f.length;g<h;g++)c(d[f[g]],e+f[g]+".")})(enchant,"");if(null!=a&&a.length)throw Error("Cannot load module: "+
a.join(", "));};window.addEventListener("message",function(a,b){try{var c=JSON.parse(a.data);if("event"===c.type)enchant.Game.instance.dispatchEvent(new enchant.Event(c.value));else if("debug"===c.type)switch(c.value){case "start":enchant.Game.instance.start();break;case "pause":enchant.Game.instance.pause();break;case "resume":enchant.Game.instance.resume();break;case "tick":enchant.Game.instance._tick(window.now())}}catch(d){}},!1);enchant.Class=function(a,b){return enchant.Class.create(a,b)};
enchant.Class.create=function(a,b){if(0===arguments.length)return enchant.Class.create(Object,b);if(1===arguments.length&&"function"!==typeof arguments[0])return enchant.Class.create(Object,arguments[0]);for(var c in b)b.hasOwnProperty(c)&&("object"===typeof b[c]&&Object.getPrototypeOf(b[c])===Object.prototype?"enumerable"in b[c]||(b[c].enumerable=!0):b[c]={value:b[c],enumerable:!0,writable:!0});var d=function(){if(this instanceof d)d.prototype.initialize.apply(this,arguments);else return new d};
d.prototype=Object.create(a.prototype,b);d.prototype.constructor=d;null==d.prototype.initialize&&(d.prototype.initialize=function(){a.apply(this,arguments)});return d};
enchant.ENV={VENDOR_PREFIX:function(){var a=navigator.userAgent;return-1!==a.indexOf("Opera")?"O":-1!==a.indexOf("MSIE")?"ms":-1!==a.indexOf("WebKit")?"webkit":"Gecko"===navigator.product?"Moz":""}(),TOUCH_ENABLED:function(){var a=document.createElement("div");a.setAttribute("ontouchstart","return");return"function"===typeof a.ontouchstart}(),RETINA_DISPLAY:function(){if(-1!==navigator.userAgent.indexOf("iPhone")&&2===window.devicePixelRatio){var a=document.querySelector('meta[name="viewport"]');
null==a&&(a=document.createElement("meta"),document.head.appendChild(a));a.setAttribute("content","width=640");return!0}return!1}(),USE_FLASH_SOUND:function(){var a=navigator.userAgent,b=navigator.vendor||"";return 0===location.href.indexOf("http")&&-1===a.indexOf("Mobile")&&-1!==b.indexOf("Apple")}(),USE_DEFAULT_EVENT_TAGS:["input","textarea","select","area"],CANVAS_DRAWING_METHODS:"putImageData drawImage drawFocusRing fill stroke clearRect fillRect strokeRect fillText strokeText".split(" "),KEY_BIND_TABLE:{37:"left",
38:"up",39:"right",40:"down"},PREVENT_DEFAULT_KEY_CODES:[37,38,39,40,32]};enchant.Event=enchant.Class.create({initialize:function(a){this.type=a;this.target=null;this.localY=this.localX=this.y=this.x=0},_initPosition:function(a,b){var c=enchant.Game.instance;this.x=this.localX=(a-c._pageX)/c.scale;this.y=this.localY=(b-c._pageY)/c.scale}});enchant.Event.LOAD="load";enchant.Event.PROGRESS="progress";enchant.Event.ENTER_FRAME="enterframe";enchant.Event.EXIT_FRAME="exitframe";enchant.Event.ENTER="enter";
enchant.Event.EXIT="exit";enchant.Event.ADDED="added";enchant.Event.ADDED_TO_SCENE="addedtoscene";enchant.Event.REMOVED="removed";enchant.Event.REMOVED_FROM_SCENE="removedfromscene";enchant.Event.TOUCH_START="touchstart";enchant.Event.TOUCH_MOVE="touchmove";enchant.Event.TOUCH_END="touchend";enchant.Event.RENDER="render";enchant.Event.INPUT_START="inputstart";enchant.Event.INPUT_CHANGE="inputchange";enchant.Event.INPUT_END="inputend";enchant.Event.LEFT_BUTTON_DOWN="leftbuttondown";
enchant.Event.LEFT_BUTTON_UP="leftbuttonup";enchant.Event.RIGHT_BUTTON_DOWN="rightbuttondown";enchant.Event.RIGHT_BUTTON_UP="rightbuttonup";enchant.Event.UP_BUTTON_DOWN="upbuttondown";enchant.Event.UP_BUTTON_UP="upbuttonup";enchant.Event.DOWN_BUTTON_DOWN="downbuttondown";enchant.Event.DOWN_BUTTON_UP="downbuttonup";enchant.Event.A_BUTTON_DOWN="abuttondown";enchant.Event.A_BUTTON_UP="abuttonup";enchant.Event.B_BUTTON_DOWN="bbuttondown";enchant.Event.B_BUTTON_UP="bbuttonup";
enchant.EventTarget=enchant.Class.create({initialize:function(){this._listeners={}},addEventListener:function(a,b){var c=this._listeners[a];null==c?this._listeners[a]=[b]:-1===c.indexOf(b)&&c.unshift(b)},on:function(){this.addEventListener.apply(this,arguments)},removeEventListener:function(a,b){var c=this._listeners[a];if(null!=c){var d=c.indexOf(b);-1!==d&&c.splice(d,1)}},clearEventListener:function(a){null!=a?delete this._listeners[a]:this._listeners={}},dispatchEvent:function(a){a.target=this;
a.localX=a.x-this._offsetX;a.localY=a.y-this._offsetY;if(null!=this["on"+a.type])this["on"+a.type](a);var b=this._listeners[a.type];if(null!=b)for(var b=b.slice(),c=0,d=b.length;c<d;c++)b[c].call(this,a)}});
(function(){var a;enchant.Game=enchant.Class.create(enchant.EventTarget,{initialize:function(b,c){if(null===window.document.body)throw Error("document.body is null. Please excute 'new Game()' in window.onload.");enchant.EventTarget.call(this);var d=!0;a&&(d=!1,a.stop());a=enchant.Game.instance=this;this.width=b||320;this.height=c||320;this.scale=1;var e=document.getElementById("enchant-stage");if(e){var f=window.getComputedStyle(e);b=parseInt(f.width,10);c=parseInt(f.height,10);b&&c?this.scale=Math.min(b/
this.width,c/this.height):(e.style.width=this.width+"px",e.style.height=this.height+"px");for(;e.firstChild;)e.removeChild(e.firstChild);e.style.position="relative";f=e.getBoundingClientRect();this._pageX=Math.round(window.scrollX+f.left);this._pageY=Math.round(window.scrollY+f.top)}else e=document.createElement("div"),e.id="enchant-stage",e.style.width=window.innerWidth+"px",e.style.height=window.innerHeight+"px",e.style.position="absolute",document.body.firstChild?document.body.insertBefore(e,document.body.firstChild):
document.body.appendChild(e),this.scale=Math.min(window.innerWidth/this.width,window.innerHeight/this.height),this._pageY=this._pageX=0;this.scale||(this.scale=1);e.style.fontSize="12px";e.style.webkitTextSizeAdjust="none";this._element=e;this.fps=30;this.frame=0;this.ready=null;this._pause=this.running=!1;this.assets={};var g=this._assets=[];(function r(a){a.assets instanceof Array&&[].push.apply(g,a.assets);for(var b in a)a.hasOwnProperty(b)&&"object"===typeof a[b]&&Object.getPrototypeOf(a[b])===
Object.prototype&&r(a[b])})(enchant);this._scenes=[];this.currentScene=null;this.rootScene=new enchant.Scene;this.pushScene(this.rootScene);this.loadingScene=new enchant.Scene;this.loadingScene.backgroundColor="#000";var h=.4*this.width|0,m=.05*this.width|0,k=.03*h|0,e=new enchant.Sprite(h,m);e.x=(this.width-h)/2;e.y=(this.height-m)/2;var l=new enchant.Surface(h,m);l.context.fillStyle="#fff";l.context.fillRect(0,0,h,m);l.context.fillStyle="#000";l.context.fillRect(k,k,h-2*k,m-2*k);e.image=l;var n=
0,q=0;this.addEventListener("progress",function(a){n=a.loaded/a.total});e.addEventListener("enterframe",function(){q*=.9;q+=.1*n;l.context.fillStyle="#fff";l.context.fillRect(k,0,(h-2*k)*q,m)});this.loadingScene.addChild(e);this._offsetY=this._offsetX=this._soundID=this._surfaceID=this._mousedownID=0;this.input={};this._keybind=enchant.ENV.KEY_BIND_TABLE||{};var u=0;"left right up down a b".split(" ").forEach(function(a){this.addEventListener(a+"buttondown",function(b){var c;this.input[a]||(this.input[a]=
!0,c=new enchant.Event(u++?"inputchange":"inputstart"),this.dispatchEvent(c));this.currentScene.dispatchEvent(b);c&&this.currentScene.dispatchEvent(c)});this.addEventListener(a+"buttonup",function(b){var c;this.input[a]&&(this.input[a]=!1,c=new enchant.Event(--u?"inputchange":"inputend"),this.dispatchEvent(c));this.currentScene.dispatchEvent(b);c&&this.currentScene.dispatchEvent(c)})},this);if(d){var e=enchant.Game.instance._element,t;document.addEventListener("keydown",function(b){a.dispatchEvent(new enchant.Event("keydown"));
-1!==enchant.ENV.PREVENT_DEFAULT_KEY_CODES.indexOf(b.keyCode)&&(b.preventDefault(),b.stopPropagation());a.running&&(b=a._keybind[b.keyCode])&&(t=new enchant.Event(b+"buttondown"),a.dispatchEvent(t))},!0);document.addEventListener("keyup",function(b){a.running&&(b=a._keybind[b.keyCode])&&(t=new enchant.Event(b+"buttonup"),a.dispatchEvent(t))},!0);enchant.ENV.TOUCH_ENABLED&&(e.addEventListener("touchstart",function(b){var c=b.target.tagName.toLowerCase();-1===enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)&&
(b.target.classList.add("tap"),b.preventDefault(),a.running||b.stopPropagation())},!0),e.addEventListener("touchmove",function(b){var c=b.target.tagName.toLowerCase();-1===enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)&&(b.preventDefault(),a.running||b.stopPropagation())},!0),e.addEventListener("touchend",function(b){var c=b.target.tagName.toLowerCase();-1===enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)&&(b.target.classList.remove("tap"),b.preventDefault(),a.running||b.stopPropagation())},!0));e.addEventListener("mousedown",
function(b){var c=b.target.tagName.toLowerCase();-1===enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)&&(b.preventDefault(),a._mousedownID++,a.running||b.stopPropagation())},!0);e.addEventListener("mousemove",function(b){var c=b.target.tagName.toLowerCase();-1===enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)&&(b.preventDefault(),a.running||b.stopPropagation())},!0);e.addEventListener("mouseup",function(b){var c=b.target.tagName.toLowerCase();-1===enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)&&(b.preventDefault(),
a.running||b.stopPropagation())},!0)}},preload:function(a){a instanceof Array||(a=Array.prototype.slice.call(arguments));[].push.apply(this._assets,a)},load:function(b,c){null==c&&(c=function(){});var d=enchant.Game.findExt(b);if(enchant.Game._loadFuncs[d])enchant.Game._loadFuncs[d].call(this,b,c,d);else{var e=new XMLHttpRequest;e.open("GET",b,!0);e.onreadystatechange=function(d){if(4===e.readyState){if(200!==e.status&&0!==e.status)throw Error(e.status+": Cannot load an asset: "+b);d=e.getResponseHeader("Content-Type")||
"";d.match(/^image/)?(a.assets[b]=enchant.Surface.load(b),a.assets[b].addEventListener("load",c)):d.match(/^audio/)?(a.assets[b]=enchant.Sound.load(b,d),a.assets[b].addEventListener("load",c)):(a.assets[b]=e.responseText,c())}};e.send(null)}},start:function(){if(!this.running)if(this._assets.length){if(enchant.Sound.enabledInMobileSafari&&!a._touched&&"webkit"===enchant.ENV.VENDOR_PREFIX&&enchant.ENV.TOUCH_ENABLED){var b=new enchant.Scene;b.backgroundColor="#000";var c=Math.round(a.width/10),d=new enchant.Sprite(a.width,
c);d.y=(a.height-c)/2;d.image=new enchant.Surface(a.width,c);d.image.context.fillStyle="#fff";d.image.context.font=c-1+"px bold Helvetica,Arial,sans-serif";var e=d.image.context.measureText("Touch to Start").width;d.image.context.fillText("Touch to Start",(a.width-e)/2,c-1);b.addChild(d);document.addEventListener("touchstart",function(){a._touched=!0;a.removeScene(b);a.start()},!0);a.pushScene(b);return}var f={},c=this._assets.filter(function(a){return a in f?!1:f[a]=!0}),g=0,h=c.length,d=function(){var b=
new enchant.Event("progress");b.loaded=++g;b.total=h;a.dispatchEvent(b);g===h&&(a.removeScene(a.loadingScene),a.dispatchEvent(new enchant.Event("load")))},e=0;for(;e<h;e++)this.load(c[e],d);this.pushScene(this.loadingScene)}else this.dispatchEvent(new enchant.Event("load"));window.requestAnimationFrame(function(b){function c(e){var f=e-b;b=e;a.running&&!a._pause&&(d+=f,f=1E3/a.fps,d>=f&&(d%=f,a._tick(e)));window.requestAnimationFrame(c)}var d=0;a.currentTime=b;a.running=!0;window.requestAnimationFrame(c)})},
debug:function(){this._debug=!0;this.rootScene.addEventListener("enterframe",function(a){this._actualFps=1/a});this.start()},actualFps:{get:function(){return this._actualFps||this.fps}},_tick:function(a){var c=new enchant.Event("enterframe");c.elapsed=a-this.currentTime;this.currentTime=a;a=this.currentScene.childNodes.slice();for(var d=Array.prototype.push;a.length;){var e=a.pop();e.age++;e.dispatchEvent(c);e.childNodes&&d.apply(a,e.childNodes)}this.currentScene.age++;this.currentScene.dispatchEvent(c);
this.dispatchEvent(c);this.dispatchEvent(new enchant.Event("exitframe"));this.frame++},stop:function(){this.running=!1},pause:function(){this._pause=!0},resume:function(){this._pause&&(this._pause=!1,this.running=!0)},pushScene:function(a){this._element.appendChild(a._element);this.currentScene&&this.currentScene.dispatchEvent(new enchant.Event("exit"));this.currentScene=a;this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.push(a)},popScene:function(){if(this.currentScene===
this.rootScene)return this.currentScene;this._element.removeChild(this.currentScene._element);this.currentScene.dispatchEvent(new enchant.Event("exit"));this.currentScene=this._scenes[this._scenes.length-2];this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.pop()},replaceScene:function(a){this.popScene();return this.pushScene(a)},removeScene:function(a){if(this.currentScene===a)return this.popScene();var c=this._scenes.indexOf(a);return-1!==c?(this._scenes.splice(c,1),
this._element.removeChild(a._element),a):null},keybind:function(a,c){this._keybind[a]=c},getElapsedTime:function(){return this.frame/this.fps}});enchant.Game._loadFuncs={};enchant.Game._loadFuncs.jpg=enchant.Game._loadFuncs.jpeg=enchant.Game._loadFuncs.gif=enchant.Game._loadFuncs.png=enchant.Game._loadFuncs.bmp=function(a,c){this.assets[a]=enchant.Surface.load(a);this.assets[a].addEventListener("load",c)};enchant.Game._loadFuncs.mp3=enchant.Game._loadFuncs.aac=enchant.Game._loadFuncs.m4a=enchant.Game._loadFuncs.wav=
enchant.Game._loadFuncs.ogg=function(a,c,d){this.assets[a]=enchant.Sound.load(a,"audio/"+d);this.assets[a].addEventListener("load",c)};enchant.Game.findExt=function(a){var c=a.match(/\.\w+$/);return c&&0<c.length?c[0].slice(1).toLowerCase():0===a.indexOf("data:")?a.split(/[\/;]/)[1].toLowerCase():null};enchant.Game.instance=null})();
enchant.Node=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);this.age=this._offsetY=this._offsetX=this._y=this._x=0;this.scene=this.parentNode=null;this.addEventListener("touchstart",function(a){this.parentNode&&!this.parentNode._element&&this.parentNode.dispatchEvent(a)});this.addEventListener("touchmove",function(a){this.parentNode&&!this.parentNode._element&&this.parentNode.dispatchEvent(a)});this.addEventListener("touchend",function(a){this.parentNode&&
!this.parentNode._element&&this.parentNode.dispatchEvent(a)})},moveTo:function(a,b){this._x=a;this._y=b;this._updateCoordinate()},moveBy:function(a,b){this._x+=a;this._y+=b;this._updateCoordinate()},x:{get:function(){return this._x},set:function(a){this._x=a;this._updateCoordinate()}},y:{get:function(){return this._y},set:function(a){this._y=a;this._updateCoordinate()}},_updateCoordinate:function(){this.parentNode?(this._offsetX=this.parentNode._offsetX+this._x,this._offsetY=this.parentNode._offsetY+
this._y):(this._offsetX=this._x,this._offsetY=this._y)},remove:function(){this._listener&&this.clearEventListener();this.parentNode&&this.parentNode.removeChild(this)}});
enchant.Entity=enchant.Class.create(enchant.Node,{initialize:function(){var a=enchant.Game.instance;enchant.Node.call(this);this._element=document.createElement("div");this._style=this._element.style;this._style.position="absolute";this._height=this._width=0;this._backgroundColor=null;this._opacity=1;this._visible=!0;this._buttonMode=null;enchant.Game.instance._debug&&(this._style.border="1px solid blue",this._style.margin="-1px");this.buttonMode=null;this.buttonPressed=!1;this.addEventListener("touchstart",
function(){if(this.buttonMode){this.buttonPressed=!0;var b=new enchant.Event(this.buttonMode+"buttondown");this.dispatchEvent(b);a.dispatchEvent(b)}});this.addEventListener("touchend",function(){if(this.buttonMode){this.buttonPressed=!1;var b=new enchant.Event(this.buttonMode+"buttonup");this.dispatchEvent(b);a.dispatchEvent(b)}});var b=this,c=function(){b.dispatchEvent(new enchant.Event("render"))};this.addEventListener("addedtoscene",function(){c();a.addEventListener("exitframe",c)});this.addEventListener("removedfromscene",
function(){a.removeEventListener("exitframe",c)});this.addEventListener("render",function(){this._offsetX!==this._previousOffsetX&&(this._style.left=this._offsetX+"px");this._offsetY!==this._previousOffsetY&&(this._style.top=this._offsetY+"px");this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY});enchant.ENV.TOUCH_ENABLED&&(this._element.addEventListener("touchstart",function(a){for(var c=a.touches,f=0,g=c.length;f<g;f++)a=new enchant.Event("touchstart"),a.identifier=c[f].identifier,
a._initPosition(c[f].pageX,c[f].pageY),b.dispatchEvent(a)},!1),this._element.addEventListener("touchmove",function(a){for(var c=a.touches,f=0,g=c.length;f<g;f++)a=new enchant.Event("touchmove"),a.identifier=c[f].identifier,a._initPosition(c[f].pageX,c[f].pageY),b.dispatchEvent(a)},!1),this._element.addEventListener("touchend",function(a){for(var c=a.changedTouches,f=0,g=c.length;f<g;f++)a=new enchant.Event("touchend"),a.identifier=c[f].identifier,a._initPosition(c[f].pageX,c[f].pageY),b.dispatchEvent(a)},
!1));this._element.addEventListener("mousedown",function(c){var e=c.pageX,f=c.pageY;c=new enchant.Event("touchstart");c.identifier=a._mousedownID;c._initPosition(e,f);b.dispatchEvent(c);b._mousedown=!0},!1);a._element.addEventListener("mousemove",function(c){if(b._mousedown){var e=c.pageX,f=c.pageY;c=new enchant.Event("touchmove");c.identifier=a._mousedownID;c._initPosition(e,f);b.dispatchEvent(c)}},!1);a._element.addEventListener("mouseup",function(c){if(b._mousedown){var e=c.pageX,f=c.pageY;c=new enchant.Event("touchend");
c.identifier=a._mousedownID;c._initPosition(e,f);b.dispatchEvent(c);b._mousedown=!1}},!1)},id:{get:function(){return this._element.id},set:function(a){this._element.id=a}},className:{get:function(){return this._element.className},set:function(a){this._element.className=a}},width:{get:function(){return this._width},set:function(a){this._style.width=(this._width=a)+"px"}},height:{get:function(){return this._height},set:function(a){this._style.height=(this._height=a)+"px"}},backgroundColor:{get:function(){return this._backgroundColor},
set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},opacity:{get:function(){return this._opacity},set:function(a){this._style.opacity=this._opacity=a}},visible:{get:function(){return this._visible},set:function(a){(this._visible=a)?this._style.display="block":this._style.display="none"}},touchEnabled:{get:function(){return this._touchEnabled},set:function(a){(this._touchEnabled=a)?this._style.pointerEvents="all":this._style.pointerEvents="none"}},intersect:function(a){return this._offsetX<
a._offsetX+a.width&&a._offsetX<this._offsetX+this.width&&this._offsetY<a._offsetY+a.height&&a._offsetY<this._offsetY+this.height},within:function(a,b){null==b&&(b=(this.width+this.height+a.width+a.height)/4);var c;return(c=this._offsetX-a._offsetX+(this.width-a.width)/2)*c+(c=this._offsetY-a._offsetY+(this.height-a.height)/2)*c<b*b},scale:function(a,b){null==b&&(b=a);this._scaleX*=a;this._scaleY*=b;this._dirty=!0},rotate:function(a){this._rotation+=a;this._dirty=!0},scaleX:{get:function(){return this._scaleX},
set:function(a){this._scaleX=a;this._dirty=!0}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a;this._dirty=!0}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a;this._dirty=!0}},originX:{get:function(){return this._originX},set:function(a){this._originX=a}},originY:{get:function(){return this._originY},set:function(a){this._originY=a}}});
enchant.Sprite=enchant.Class.create(enchant.Entity,{initialize:function(a,b){enchant.Entity.call(this);this.width=a;this.height=b;this._scaleY=this._scaleX=1;this._rotation=0;this._dirty=!1;this._image=null;this._frame=0;this._frameSequence=[];this._style.overflow="hidden";this.addEventListener("render",function(){if(this._dirty){var a=["rotate(",this._rotation,"deg)","scale(",this._scaleX,",",this._scaleY,")"];-1!==navigator.userAgent.indexOf("iPhone")&&a.push("translate3d(0,0,0)");this._style[enchant.ENV.VENDOR_PREFIX+
"Transform"]=a.join("");this._dirty=!1}});this.addEventListener("enterframe",function(){if(0!==this._frameSequence.length){var a=this._frameSequence.shift();null===a?this._frameSequence=[]:(this._setFrame(a),this._frameSequence.push(a))}});enchant.Game.instance._debug&&(this._style.border="1px solid red",this._style.margin="-1px")},image:{get:function(){return this._image},set:function(a){if(a!==this._image){null!=this._image&&(this._image.css?this._style.backgroundImage="":this._element.firstChild&&
(this._element.removeChild(this._element.firstChild),this._dirtyListener?(this.removeEventListener("render",this._dirtyListener),this._dirtyListener=null):this._image._parent=null));if(null!=a)if(a._css)this._style.backgroundImage=a._css;else if(a._parent){var b=document.createElement("canvas"),c=b.getContext("2d");b.width=a.width;b.height=a.height;c.drawImage(a._element,0,0);this._dirtyListener=function(){a._dirty&&(c.drawImage(a._element),a._dirty=!1)};this.addEventListener("render",this._dirtyListener);
this._element.appendChild(b)}else a._parent=this,this._element.appendChild(a._element);this._image=a;this.frame=this.frame}}},frame:{get:function(){return this._frame},set:function(a){if(a instanceof Array){var b=a.shift();this._setFrame(b);a.push(b);this._frameSequence=a}else this._setFrame(a),this._frameSequence=[],this._frame=a}},_setFrame:function(a){if(null!=this._image){this._frame=a;var b=this._image.width/this._width|0;if(this._image._css)this._style.backgroundPosition=[-(a%b|0)*this._width,
"px ",-(a/b|0)*this._height,"px"].join("");else if(this._element.firstChild){var c=this._element.firstChild.style;c.left=-(a%b|0)*this._width+"px";c.top=-(a/b|0)*this._height+"px"}}}});
enchant.Label=enchant.Class.create(enchant.Entity,{initialize:function(a){enchant.Entity.call(this);this.width=300;this.text=a;this.textAlign="left"},text:{get:function(){return this._element.innerHTML},set:function(a){this._element.innerHTML=a}},textAlign:{get:function(){return this._style.textAlign},set:function(a){this._style.textAlign=a}},font:{get:function(){return this._style.font},set:function(a){this._style.font=a}},color:{get:function(){return this._style.color},set:function(a){this._style.color=
a}}});
(function(){enchant.Map=enchant.Class.create(enchant.Entity,{initialize:function(a,b){var c=enchant.Game.instance;enchant.Entity.call(this);var d=document.createElement("canvas");enchant.ENV.RETINA_DISPLAY&&2===c.scale?(d.width=2*c.width,d.height=2*c.height,this._style.webkitTransformOrigin="0 0",this._style.webkitTransform="scale(0.5)"):(d.width=c.width,d.height=c.height);this._element.appendChild(d);this._context=d.getContext("2d");this._tileWidth=a||0;this._tileHeight=b||0;this._image=null;this._data=
[[[]]];this.touchEnabled=this._tight=this._dirty=!1;this.collisionData=null;this._listeners.render=null;this.addEventListener("render",function(){if(this._dirty||null==this._previousOffsetX)this._dirty=!1,this.redraw(0,0,c.width,c.height);else if(this._offsetX!==this._previousOffsetX||this._offsetY!==this._previousOffsetY)if(this._tight){var a=-this._offsetX,b=-this._offsetY,d=-this._previousOffsetX,h=-this._previousOffsetY,m=a-d+c.width,k=d-a+c.width,l=b-h+c.height,n=h-b+c.height;if(m>this._tileWidth&&
k>this._tileWidth&&l>this._tileHeight&&n>this._tileHeight){var q;m<k?(q=0,a=d-a,k=m):(q=a-d,a=0);l<n?(m=0,b=h-b):(m=b-h,b=0,l=n);null==c._buffer&&(c._buffer=document.createElement("canvas"),c._buffer.width=this._context.canvas.width,c._buffer.height=this._context.canvas.height);n=c._buffer.getContext("2d");this._doubledImage?(n.clearRect(0,0,2*k,2*l),n.drawImage(this._context.canvas,2*q,2*m,2*k,2*l,0,0,2*k,2*l),n=this._context,n.clearRect(2*a,2*b,2*k,2*l),n.drawImage(c._buffer,0,0,2*k,2*l,2*a,2*b,
2*k,2*l)):(n.clearRect(0,0,k,l),n.drawImage(this._context.canvas,q,m,k,l,0,0,k,l),n=this._context,n.clearRect(a,b,k,l),n.drawImage(c._buffer,0,0,k,l,a,b,k,l));0===a?this.redraw(k,0,c.width-k,c.height):this.redraw(0,0,c.width-k,c.height);0===b?this.redraw(0,l,c.width,c.height-l):this.redraw(0,0,c.width,c.height-l)}else this.redraw(0,0,c.width,c.height)}else this.redraw(0,0,c.width,c.height);this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY})},loadData:function(a){this._data=Array.prototype.slice.apply(arguments);
this._dirty=!0;this._tight=!1;for(var b=0,c=this._data.length;b<c;b++){var d=0;a=this._data[b];for(var e=0,f=a.length;e<f;e++)for(var g=0,h=a[e].length;g<h;g++)0<=a[e][g]&&d++;if(.2<d/(a.length*a[0].length)){this._tight=!0;break}}},checkTile:function(a,b){if(0>a||this.width<=a||0>b||this.height<=b)return!1;var c=this._image.width,d=this._image.height,d=this._tileHeight||d;a=a/(this._tileWidth||c)|0;return this._data[0][b/d|0][a]},hitTest:function(a,b){if(0>a||this.width<=a||0>b||this.height<=b)return!1;
var c=this._image.width,d=this._image.height,e=this._tileWidth||c,f=this._tileHeight||d;a=a/e|0;b=b/f|0;if(null!=this.collisionData)return this.collisionData[b]&&!!this.collisionData[b][a];for(var g=0,h=this._data.length;g<h;g++){var m=this._data[g],k;if(null!=m[b]&&null!=(k=m[b][a])&&0<=k&&k<(c/e|0)*(d/f|0))return!0}return!1},image:{get:function(){return this._image},set:function(a){var b=enchant.Game.instance;this._image=a;if(enchant.ENV.RETINA_DISPLAY&&2===b.scale){for(var b=new enchant.Surface(2*
a.width,2*a.height),c=this._tileWidth||a.width,d=this._tileHeight||a.height,e=a.width/c|0,f=a.height/d|0,g=0;g<f;g++)for(var h=0;h<e;h++)b.draw(a,h*c,g*d,c,d,h*c*2,g*d*2,2*c,2*d);this._doubledImage=b}this._dirty=!0}},tileWidth:{get:function(){return this._tileWidth},set:function(a){this._tileWidth=a;this._dirty=!0}},tileHeight:{get:function(){return this._tileHeight},set:function(a){this._tileHeight=a;this._dirty=!0}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*
this._data[0].length}},redraw:function(a,b,c,d){if(null!=this._image){var e,f,g,h,m;this._doubledImage?(e=this._doubledImage,f=2*this._tileWidth,g=2*this._tileHeight,h=2*-this._offsetX,m=2*-this._offsetY,a*=2,b*=2,c*=2,d*=2):(e=this._image,f=this._tileWidth,g=this._tileHeight,h=-this._offsetX,m=-this._offsetY);var k=e.width/f|0,l=e.height/g|0,n=Math.max((a+h)/f|0,0),q=Math.max((b+m)/g|0,0),u=Math.ceil((a+h+c)/f),t=Math.ceil((b+m+d)/g);e=e._element;var v=this._context;v.clearRect(a,b,c,d);c=0;for(d=
this._data.length;c<d;c++){var r=this._data[c],p=Math.min(u,r[0].length),x=Math.min(t,r.length);for(b=q;b<x;b++)for(a=n;a<p;a++){var w=r[b][a];0<=w&&w<k*l&&v.drawImage(e,w%k*f,(w/k|0)*g,f,g,a*f-h,b*g-m,f,g)}}}}})})();
enchant.Group=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this.childNodes=[];this._y=this._x=0;[enchant.Event.ADDED_TO_SCENE,enchant.Event.REMOVED_FROM_SCENE].forEach(function(a){this.addEventListener(a,function(a){this.childNodes.forEach(function(c){c.scene=this.scene;c.dispatchEvent(a)},this)})},this)},addChild:function(a){this.childNodes.push(a);a.parentNode=this;a.dispatchEvent(new enchant.Event("added"));if(this.scene){var b=new enchant.Event("addedtoscene");
a.scene=this.scene;a.dispatchEvent(b);a._updateCoordinate();var c=document.createDocumentFragment(),d,e=Array.prototype.push;if(a._element)c.appendChild(a._element);else if(a.childNodes)for(d=a.childNodes.slice().reverse();d.length;)a=d.pop(),a.scene=this.scene,a.dispatchEvent(b),a._element?c.appendChild(a._element):a.childNodes&&e.apply(d,a.childNodes.reverse());if(c.childNodes.length){for(var f,b=this;b.parentNode;){d=b.parentNode.childNodes;for(d=d.slice(d.indexOf(b)+1).reverse();d.length;)if(a=
d.pop(),a._element){f=a._element;break}else a.childNodes&&e.apply(d,a.childNodes.slice().reverse());b=b.parentNode}f?this.scene._element.insertBefore(c,f):this.scene._element.appendChild(c)}}},insertBefore:function(a,b){var c=this.childNodes.indexOf(b);if(-1!==c){if(this.childNodes.splice(c,0,a),a.parentNode=this,a.dispatchEvent(new enchant.Event("added")),this.scene){var d=new enchant.Event("addedtoscene");a.scene=this.scene;a.dispatchEvent(d);a._updateCoordinate();var e=document.createDocumentFragment(),
f,g=Array.prototype.push;if(a._element)e.appendChild(a._element);else if(a.childNodes)for(f=a.childNodes.slice().reverse();f.length;)a=f.pop(),a.scene=this.scene,a.dispatchEvent(d),a._element?e.appendChild(a._element):a.childNodes&&g.apply(f,a.childNodes.reverse());if(e.childNodes.length){for(var h,d=b;d!==this;){null!=c?(f=this.childNodes.slice(c+1).reverse(),c=null):(f=d.parentNode.childNodes,f=f.slice(f.indexOf(d)+1).reverse());for(;f.length;)if(a=f.pop(),a._element){h=a._element;break}else a.childNodes&&
g.apply(f,a.childNodes.slice().reverse());d=d.parentNode}h?this.scene._element.insertBefore(e,h):this.scene._element.appendChild(e)}}}else this.addChild(a)},removeChild:function(a){var b=this.childNodes.indexOf(a);if(-1!==b&&(this.childNodes.splice(b,1),a.parentNode=null,a.dispatchEvent(new enchant.Event("removed")),this.scene))if(b=new enchant.Event("removedfromscene"),a.scene=null,a.dispatchEvent(b),a._element)this.scene._element.removeChild(a._element);else if(a.childNodes)for(var c=a.childNodes.slice(),
d=Array.prototype.push;c.length;)a=c.pop(),a.scene=null,a.dispatchEvent(b),a._element?this.scene._element.removeChild(a._element):a.childNodes&&d.apply(c,a.childNodes)},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},_updateCoordinate:function(){this.parentNode?(this._offsetX=this.parentNode._offsetX+this._x,this._offsetY=this.parentNode._offsetY+this._y):(this._offsetX=this._x,this._offsetY=this._y);for(var a=0,b=
this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()},rotation:{get:function(){return this._rotation},set:function(a){var b=a-this._rotation;if(0!==b){for(var c=b/180*Math.PI,b=Math.sin(c),c=Math.cos(c),d=0,e=this.childNodes.length;d<e;d++){var f=this.childNodes[d],g=f.x-f.originX|0,h=f.y-f.originY|0;f.x+=+c*g+b*h+f.originX|0;f.y+=-b*g+c*h+f.originY|0}this._rotation=a}}},originX:{get:function(){return this._originX},set:function(a){this._originX=a}},originY:{get:function(){return this._originY},
set:function(a){this._originY=a}}});
(function(){enchant.CanvasGroup=enchant.Class.create(enchant.Group,{initialize:function(){var b=enchant.Game.instance,p=this;enchant.Group.call(this);this._dirty=!1;this._rotation=0;this._cvsCache={matrix:[1,0,0,1,0,0],detectColor:"#0000000"};this.width=b.width;this.height=b.height;this._element=document.createElement("canvas");this._element.width=b.width;this._element.height=b.height;this._element.style.position="absolute";this._detect=document.createElement("canvas");this._detect.width=b.width;
this._detect.height=b.height;this._detect.style.position="absolute";this.context=this._element.getContext("2d");this._dctx=this._detect.getContext("2d");this._colorManager=new f(16,256);enchant.ENV.TOUCH_ENABLED&&(this._element.addEventListener("touchstart",function(a){for(var b=a.touches,d=0,r=b.length;d<r;d++)a=new enchant.Event("touchstart"),a.identifier=b[d].identifier,a._initPosition(b[d].pageX,b[d].pageY),c.call(p,a)},!1),this._element.addEventListener("touchmove",function(a){for(var b=a.touches,
c=0,r=b.length;c<r;c++)a=new enchant.Event("touchmove"),a.identifier=b[c].identifier,a._initPosition(b[c].pageX,b[c].pageY),d.call(p,a)},!1),this._element.addEventListener("touchend",function(a){for(var b=a.changedTouches,c=0,d=b.length;c<d;c++)a=new enchant.Event("touchend"),a.identifier=b[c].identifier,a._initPosition(b[c].pageX,b[c].pageY),e.call(p,a)},!1));this._element.addEventListener("mousedown",function(a){var d=a.pageX,e=a.pageY;a=new enchant.Event("touchstart");a.identifier=b._mousedownID;
a._initPosition(d,e);c.call(p,a);p._mousedown=!0},!1);b._element.addEventListener("mousemove",function(a){if(p._mousedown){var c=a.pageX,e=a.pageY;a=new enchant.Event("touchmove");a.identifier=b._mousedownID;a._initPosition(c,e);d.call(p,a)}},!1);b._element.addEventListener("mouseup",function(a){if(p._mousedown){var c=a.pageX,d=a.pageY;a=new enchant.Event("touchend");a.identifier=b._mousedownID;a._initPosition(c,d);e.call(p,a);p._mousedown=!1}},!1);var g=[enchant.Event.EXIT,enchant.Event.REMOVED_FROM_SCENE];
[enchant.Event.ENTER,enchant.Event.ADDED_TO_SCENE].forEach(function(b){this.addEventListener(b,this._startRendering);this.addEventListener(b,function(){a.push(this)})},this);g.forEach(function(b){this.addEventListener(b,this._stopRendering);this.addEventListener(b,function(){var b=a.indexOf(this);-1!==b&&a.splice(b,1)})},this);this._onexitframe=function(){var a=p.context;a.clearRect(0,0,b.width,b.height);q.call(p,p._colorManager);m.call(p,a)}},_startRendering:function(){var a=enchant.Game.instance;
a._listeners.exitframe||(a._listeners.exitframe=[]);a._listeners.exitframe.push(this._onexitframe)},_stopRendering:function(){enchant.Game.instance.removeEventListener("exitframe",this._onexitframe)},_getEntityByPosition:function(a,b){var c=this._dctx;c.clearRect(0,0,this.width,this.height);k.call(this,c);c=c.getImageData(a,b,1,1).data;return this._colorManager.getSpriteByColor(c)},_touchstartPropagation:function(a){var b=this._getEntityByPosition(a.x,a.y);b?(this._touching=b,v.call(this._touching,
a,this.parentNode)):b=null;return b},_touchmovePropagation:function(a){null!=this._touching&&v.call(this._touching,a,this.parentNode)},_touchendPropagation:function(a){null!=this._touching&&(v.call(this._touching,a,this.parentNode),this._touching=null)},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a;this._dirty=!0}},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a;this._dirty=!0}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=
a;this._dirty=!0}},addChild:function(a){this.childNodes.push(a);a.parentNode=this;a.dispatchEvent(new enchant.Event("added"));if(this.scene){a.scene=this.scene;var b=new enchant.Event("addedtoscene");u.call(a,b,this._colorManager)}},insertBefore:function(a,b){var c=this.childNodes.indexOf(b);-1!==c?(this.childNodes.splice(c,0,a),a.dispatchEvent(new enchant.Event("added")),this.scene&&(a.scene=this.scene,c=new enchant.Event("addedtoscene"),u.call(a,c,this._colorManager))):this.addChild(a)},removeChild:function(a){var b;
-1!==(b=this.childNodes.indexOf(a))&&this.childNodes.splice(b,1);a.parentNode=null;a.dispatchEvent(new enchant.Event("removed"));this.scene&&(a.scene=null,b=new enchant.Event("removedfromscene"),t.call(a,b,this._colorManager))}});var a=[],b=null,c=function(c){for(var d=enchant.Game.instance,e,f=a.length-1;0<=f;f--)if(e=a[f],e.scene===d.currentScene&&e._touchstartPropagation(c)){b=e;break}},d=function(a){null!=b&&b._touchmovePropagation(a)},e=function(a){null!=b&&(b._touchendPropagation(a),b=null)};
enchant.Map.prototype.cvsRender=function(a){var b=enchant.Game.instance;a.save();a.setTransform(1,0,0,1,0,0);a.drawImage(this._element.firstChild,0,0,b.width,b.height);a.restore()};enchant.Sprite.prototype.cvsRender=function(a){var b,c,d,e,f;this._image&&(e=Math.abs(this._frame)||0,b=this._image,c=b._element,d=b.width/this._width|0,f=(e%d|0)*this._width,d=(e/d|0)*this._height%b.height,d=Math.min(d,b.height-this._height),e=Math.min(b.width-f,this._width),b=Math.min(b.height-d,this._height),a.drawImage(c,
f,d,e,b,0,0,this._width+0,this._height+0))};enchant.Label.prototype.cvsRender=function(a){this.text&&(a.textBaseline="top",a.font=this.font,a.fillStyle=this.color||"#000000",a.fillText(this.text,0,0,this.width+0))};var f=enchant.Class.create({initialize:function(a,b){this.reference=[];this.detectColorNum=0;this.colorResolution=a||16;this.max=b||1},attachDetectColor:function(a){this.detectColorNum+=1;this.reference[this.detectColorNum]=a;return this._createNewColor()},detachDetectColor:function(a){a=
this.reference.indexOf(a);-1!==a&&(this.reference[a]=null)},_createNewColor:function(){var a=this.detectColorNum,b=this.colorResolution,c=b/this.max;return[parseInt(a/b/b%b,10)/c,parseInt(a/b%b,10)/c,parseInt(a%b,10)/c,1]},_decodeDetectColor:function(a){var b=this.colorResolution;return~~(a[0]*b*b*b/256)+~~(a[1]*b*b/256)+~~(a[2]*b/256)},getSpriteByColor:function(a){return this.reference[this._decodeDetectColor(a)]}}),g=function(a,b){a=a||function(){};b=b||function(){};var c=function(){a.apply(this,
arguments);var d;if(this.childNodes)for(var e=0,f=this.childNodes.length;e<f;e++)d=this.childNodes[e],c.apply(d,arguments);b.apply(this,arguments)};return c},h=function(a){if(a.__dirty||a._cvsCache.x!==a.x||a._cvsCache.y!==a.y||a._cvsCache.width!==a.width||a._cvsCache.height!==a.height){var b=a._cvsCache.matrix,c=a.x,d=a.y,e=a.width||0,f=a.height||0,g="number"===typeof a.scaleX?a.scaleX:1,h="number"===typeof a.scaleY?a.scaleY:1,k=Math.PI*(a.rotation||0)/180,l=Math.cos(k),k=Math.sin(k),e="number"===
typeof a.originX?a.originX:e/2,f="number"===typeof a.originY?a.originY:f/2;b[0]=g*l;b[1]=g*k;b[2]=-h*k;b[3]=h*l;b[4]=-(g*l)*e+h*k*f+c+e;b[5]=-(g*k)*e-h*l*f+d+f;a.__dirty=!1;a._cvsCache.x=a.x;a._cvsCache.y=a.y;a._cvsCache.width=a.width;a._cvsCache.height=a.height}},m=g(function(a){a.save();a.globalCompositeOperation=this.alphaBlending?this.alphaBlending:"source-over";a.globalAlpha="number"===typeof this.opacity?this.opacity:1;h(this);a.transform.apply(a,this._cvsCache.matrix);var b=enchant.Game.instance;
if("undefined"===typeof this.visible||this.visible)this.backgroundColor&&(a.fillStyle=this.backgroundColor,a.fillRect(0,0,this.width+0,this.height+0)),this.cvsRender&&this.cvsRender(a),b._debug&&(a.strokeStyle=this instanceof enchant.Label||this instanceof enchant.Sprite?"#ff0000":"#0000ff",a.strokeRect(0,0,this.width+0,this.height+0))},function(a){a.restore()}),k=g(function(a){a.save();h(this);a.transform.apply(a,this._cvsCache.matrix);a.fillStyle=this._cvsCache.detectColor;a.fillRect(0,0,this.width,
this.height)},function(a){a.restore()}),l=function(){this.__dirty=this._dirty?!0:!1},n=function(a){if(!this._cvsCache){this.addEventListener("render",l);this._cvsCache={};this._cvsCache.matrix=[];var b=this._cvsCache;a=a.attachDetectColor(this);a="#"+("00"+Number(parseInt(a[0],10)).toString(16)).slice(-2)+("00"+Number(parseInt(a[1],10)).toString(16)).slice(-2)+("00"+Number(parseInt(a[2],10)).toString(16)).slice(-2);b.detectColor=a}},q=g(function(a){n.call(this,a)}),u=g(function(a,b){this.dispatchEvent(a);
n.call(this,b)}),t=g(function(a,b){this.dispatchEvent(a);this._cvsCache&&(this.removeEventListener("render",l),b.detachDetectColor(this),delete this._cvsCache)});g(function(a){this.dispatchEvent(a)});var v=function(a,b){this.dispatchEvent(a);this.parentNode&&this.parentNode!==b&&v.call(this.parentNode,a,b)}})();
enchant.Scene=enchant.Class.create(enchant.Group,{initialize:function(){enchant.Group.call(this);this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.overflow="hidden";this._element.style.width=(this.width=enchant.Game.instance.width)+"px";this._element.style.height=(this.height=enchant.Game.instance.height)+"px";this._element.style[enchant.ENV.VENDOR_PREFIX+"TransformOrigin"]="0 0";this._element.style[enchant.ENV.VENDOR_PREFIX+"Transform"]="scale("+
enchant.Game.instance.scale+")";this.scene=this;var a=this;enchant.ENV.TOUCH_ENABLED&&(this._element.addEventListener("touchstart",function(b){for(var c=b.touches,d=0,e=c.length;d<e;d++)b=new enchant.Event("touchstart"),b.identifier=c[d].identifier,b._initPosition(c[d].pageX,c[d].pageY),a.dispatchEvent(b)},!1),this._element.addEventListener("touchmove",function(b){for(var c=b.touches,d=0,e=c.length;d<e;d++)b=new enchant.Event("touchmove"),b.identifier=c[d].identifier,b._initPosition(c[d].pageX,c[d].pageY),
a.dispatchEvent(b)},!1),this._element.addEventListener("touchend",function(b){for(var c=b.changedTouches,d=0,e=c.length;d<e;d++)b=new enchant.Event("touchend"),b.identifier=c[d].identifier,b._initPosition(c[d].pageX,c[d].pageY),a.dispatchEvent(b)},!1));this._element.addEventListener("mousedown",function(b){var c=b.pageX,d=b.pageY;b=new enchant.Event("touchstart");b.identifier=enchant.Game.instance._mousedownID;b._initPosition(c,d);a.dispatchEvent(b);a._mousedown=!0},!1);enchant.Game.instance._element.addEventListener("mousemove",
function(b){if(a._mousedown){var c=b.pageX,d=b.pageY;b=new enchant.Event("touchmove");b.identifier=enchant.Game.instance._mousedownID;b._initPosition(c,d);a.dispatchEvent(b)}},!1);enchant.Game.instance._element.addEventListener("mouseup",function(b){if(a._mousedown){var c=b.pageX,d=b.pageY;b=new enchant.Event("touchend");b.identifier=enchant.Game.instance._mousedownID;b._initPosition(c,d);a.dispatchEvent(b);a._mousedown=!1}},!1)},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=
this._backgroundColor=a}},_updateCoordinate:function(){this._offsetX=this._x;this._offsetY=this._y;for(var a=0,b=this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()}});
enchant.Surface=enchant.Class.create(enchant.EventTarget,{initialize:function(a,b){enchant.EventTarget.call(this);var c=enchant.Game.instance;this.width=a;this.height=b;this.context=null;c="enchant-surface"+c._surfaceID++;document.getCSSCanvasContext?(this.context=document.getCSSCanvasContext("2d",c,a,b),this._element=this.context.canvas,this._css="-webkit-canvas("+c+")"):document.mozSetImageElement?(this._element=document.createElement("canvas"),this._element.width=a,this._element.height=b,this._css=
"-moz-element(#"+c+")",this.context=this._element.getContext("2d"),document.mozSetImageElement(c,this._element)):(this._element=document.createElement("canvas"),this._element.width=a,this._element.height=b,this._element.style.position="absolute",this.context=this._element.getContext("2d"),enchant.ENV.CANVAS_DRAWING_METHODS.forEach(function(a){var b=this.context[a];this.context[a]=function(){b.apply(this,arguments);this._dirty=!0}},this))},getPixel:function(a,b){return this.context.getImageData(a,
b,1,1).data},setPixel:function(a,b,c,d,e,f){var g=this.context.createImageData(1,1);g.data[0]=c;g.data[1]=d;g.data[2]=e;g.data[3]=f;this.context.putImageData(g,a,b)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(a){a=a._element;if(1===arguments.length)this.context.drawImage(a,0,0);else{var b=arguments;b[0]=a;this.context.drawImage.apply(this.context,b)}},clone:function(){var a=new enchant.Surface(this.width,this.height);a.draw(this);return a},toDataURL:function(){var a=
this._element.src;return a?"data:"===a.slice(0,5)?a:this.clone().toDataURL():this._element.toDataURL()}});enchant.Surface.load=function(a){var b=new Image,c=Object.create(enchant.Surface.prototype,{context:{value:null},_css:{value:"url("+a+")"},_element:{value:b}});enchant.EventTarget.call(c);b.src=a;b.onerror=function(){throw Error("Cannot load an asset: "+b.src);};b.onload=function(){c.width=b.width;c.height=b.height;c.dispatchEvent(new enchant.Event("load"))};return c};
enchant.Sound=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);this.duration=0;throw Error("Illegal Constructor");},play:function(){this._element&&this._element.play()},pause:function(){this._element&&this._element.pause()},stop:function(){this.pause();this.currentTime=0},clone:function(){var a;if(this._element instanceof Audio)a=Object.create(enchant.Sound.prototype,{_element:{value:this._element.cloneNode(!1)},duration:{value:this.duration}});else{if(enchant.ENV.USE_FLASH_SOUND)return this;
a=Object.create(enchant.Sound.prototype)}enchant.EventTarget.call(a);return a},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(a){this._element&&(this._element.currentTime=a)}},volume:{get:function(){return this._element?this._element.volume:1},set:function(a){this._element&&(this._element.volume=a)}}});
enchant.Sound.load=function(a,b){if(null==b){var c=enchant.Game.findExt(a);b=c?"audio/"+c:""}b=b.replace("mp3","mpeg").replace("m4a","mp4");var d=Object.create(enchant.Sound.prototype);enchant.EventTarget.call(d);var e=new Audio;if(!enchant.Sound.enabledInMobileSafari&&"webkit"===enchant.ENV.VENDOR_PREFIX&&enchant.ENV.TOUCH_ENABLED)window.setTimeout(function(){d.dispatchEvent(new enchant.Event("load"))},0);else if(!enchant.ENV.USE_FLASH_SOUND&&e.canPlayType(b))e.src=a,e.load(),e.autoplay=!1,e.onerror=
function(){throw Error("Cannot load an asset: "+e.src);},e.addEventListener("canplaythrough",function(){d.duration=e.duration;d.dispatchEvent(new enchant.Event("load"))},!1),d._element=e;else if("audio/mpeg"===b){var f=document.createElement("embed"),c="enchant-audio"+enchant.Game.instance._soundID++;f.width=f.height=1;f.name=c;f.src="sound.swf?id="+c+"&src="+a;f.allowscriptaccess="always";f.style.position="absolute";f.style.left="-1px";d.addEventListener("load",function(){Object.defineProperties(f,
{currentTime:{get:function(){return f.getCurrentTime()},set:function(a){f.setCurrentTime(a)}},volume:{get:function(){return f.getVolume()},set:function(a){f.setVolume(a)}}});d._element=f;d.duration=f.getDuration()});enchant.Game.instance._element.appendChild(f);enchant.Sound[c]=d}else window.setTimeout(function(){d.dispatchEvent(new enchant.Event("load"))},0);return d};enchant.Sound.enabledInMobileSafari=!1;